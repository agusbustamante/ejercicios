<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Liquidaciones de Sueldos</title>
  <link rel="stylesheet" href="styles.css?v=4">
</head>
<body>
  <header class="barra-superior">
    <div class="barra-inner">
      <h1 class="titulo">Liquidaciones de Sueldos</h1>
      <div class="acciones-header">
        <button id="cargarDatos" class="boton">Cargar datos</button>
        <button id="vaciarDatos" class="boton">Vaciar datos</button>
        <button id="abrirModal" class="boton">Abrir modal</button>
      </div>
    </div>
  </header>

  <main id="principal" class="tabla-contenedor">
    <div class="tabla-wrapper">
      <table id="tablaLiquidaciones" aria-label="Tabla de liquidaciones de sueldos">
        <thead>
          <tr>
            <th campo-dato="legajo">Legajo</th>
            <th campo-dato="apellido">Apellido y nombres</th>
            <th campo-dato="fecha">Fecha</th>
            <th campo-dato="mes">Mes</th>
            <th campo-dato="sueldo">Sueldo básico</th>
            <th campo-dato="concepto">Concepto no rem. 1</th>
            <th campo-dato="monto">Monto no rem. 1</th>
            <th campo-dato="pdf">PDF</th>
          </tr>
        </thead>
        <tbody id="tbodyLiquidaciones"></tbody>
      </table>
    </div>
  </main>

  <footer class="pie">
    Programación en ambiente de redes – 2025 · Alumno: Agustin Bustamante
  </footer>

  <!-- Overlay + Modal -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <section class="modal" role="dialog" aria-modal="true" aria-labelledby="tituloModal">
      <div class="modal-header">
        <h2 id="tituloModal">Formulario de Liquidación</h2>
        <button id="cerrarModal" class="cerrar" aria-label="Cerrar">×</button>
      </div>

      <div class="modal-body">
        <form id="liquidacionForm" method="get" action="respuesta.html" target="_blank">
          <div class="fila-campos">
            <div class="grupo-campo">
              <label for="legajoEmpleado">Legajo Empleado</label>
              <input type="text" id="legajoEmpleado" name="legajoEmpleado" placeholder="Ej: 01"
                     required pattern="[0-9A-Za-z]{1,10}" title="Hasta 10 caracteres alfanuméricos">
            </div>
            <div class="grupo-campo">
              <label for="mesLiquidacion">Mes de liquidación</label>
              <input type="month" id="mesLiquidacion" name="mesLiquidacion" required>
            </div>
          </div>

          <div class="fila-campos">
            <div class="grupo-campo">
              <label for="apellidoNombres">Apellido y Nombre</label>
              <input type="text" id="apellidoNombres" name="apellidoNombres" placeholder="Ej: Bustamante Agustin" required>
            </div>
            <div class="grupo-campo">
              <label for="sueldoBasico">Sueldo básico</label>
              <input type="number" id="sueldoBasico" name="sueldoBasico" placeholder="Ej: 300000" min="0" step="0.01" required>
            </div>
          </div>

          <div class="fila-campos">
            <div class="grupo-campo">
              <label for="fechaLiquidacion">Fecha de liquidación</label>
              <input type="date" id="fechaLiquidacion" name="fechaLiquidacion" required>
            </div>
            <div class="grupo-campo">
              <label for="concepto">Concepto no remunerativo 1 (parametrizable)</label>
              <select id="concepto" name="concepto" required>
                <option value="" disabled selected>-- seleccionar --</option>
              </select>
            </div>
          </div>

          <div class="fila-campos">
            <div class="grupo-campo">
              <label for="montoConcepto">Monto no remunerativo 1</label>
              <input type="number" id="montoConcepto" name="montoConcepto" min="0" step="0.01" value="0" required>
            </div>
          </div>

          <div class="acciones">
            <button type="submit" class="boton">Enviar</button>
          </div>
        </form>
      </div>
      <footer class="pie">
        Programación en ambiente de redes – 2025 · Alumno: Agustin Bustamante
      </footer>
    </section>
  </div>
  

  <script>
  (function(){
    const dataJSON = `[
      {"LegajoEmpleado":"E001","ApellidoYNombres":"Bustamante, Agustin","Fecha_liquidacion":"2025-09-01","MesDeLiquidacion":"Septiembre 2025","SueldoBasico":750000,"concepto_noRemunerativo_1":"Indemnizaciones","Monto_no_remunerativo_1":12000.00,"pdf_liquidacion":"liquidacion-01.pdf"},
      {"LegajoEmpleado":"E002","ApellidoYNombres":"Gómez, María","Fecha_liquidacion":"2025-09-05","MesDeLiquidacion":"Septiembre 2025","SueldoBasico":600000,"concepto_noRemunerativo_1":"Asignaciones familiares","Monto_no_remunerativo_1":3500.25,"pdf_liquidacion":"liquidacion-02.pdf"},
      {"LegajoEmpleado":"E003","ApellidoYNombres":"Rodríguez, Ana","Fecha_liquidacion":"2025-09-10","MesDeLiquidacion":"Septiembre 2025","SueldoBasico":560000,"concepto_noRemunerativo_1":"Viáticos","Monto_no_remunerativo_1":7800.50,"pdf_liquidacion":"liquidacion-03.pdf"},
      {"LegajoEmpleado":"E004","ApellidoYNombres":"López, Carlos","Fecha_liquidacion":"2025-09-12","MesDeLiquidacion":"Septiembre 2025","SueldoBasico":640000,"concepto_noRemunerativo_1":"Adicional por presentismo","Monto_no_remunerativo_1":15000.00,"pdf_liquidacion":"liquidacion-04.pdf"}
    ]`;

    const conceptosJSON = `[
      {"codigo":"BONO","descripcion":"Bono anual"},
      {"codigo":"VIAT","descripcion":"Viáticos"},
      {"codigo":"HEXT","descripcion":"Horas extras"},
      {"codigo":"ASIG","descripcion":"Asignación especial"},
      {"codigo":"TRAN","descripcion":"Transporte"}
    ]`;

    function poblarSelectModal(){
      const sel = document.getElementById('concepto');
      if (!sel) return;
      [...sel.querySelectorAll('option')].forEach(op => { if(op.value) op.remove(); });
      JSON.parse(conceptosJSON).forEach(it => {
        const opt = document.createElement('option');
        opt.value = it.descripcion;
        opt.textContent = it.descripcion;
        sel.appendChild(opt);
      });
    }

    function cargarFilas(datos){
      const tbody = document.getElementById('tbodyLiquidaciones');
      const frag = document.createDocumentFragment();
      datos.forEach(reg=>{
        const tr = document.createElement('tr');
        const campos = [
          ['legajo',  reg.LegajoEmpleado],
          ['apellido',reg.ApellidoYNombres],
          ['fecha',   reg.Fecha_liquidacion],
          ['mes',     reg.MesDeLiquidacion],
          ['sueldo',  Number(reg.SueldoBasico).toFixed(2)],
          ['concepto',reg.concepto_noRemunerativo_1],
          ['monto',   Number(reg.Monto_no_remunerativo_1).toFixed(2)],
          ['pdf',      reg.pdf_liquidacion ||'']
        ];
        campos.forEach(([campo,valor])=>{
          const td = document.createElement('td');
          td.setAttribute('campo-dato', campo);
          td.textContent = valor ?? '';
          tr.appendChild(td);
        });
        frag.appendChild(tr);
      });
      tbody.appendChild(frag);
    }

    document.addEventListener('DOMContentLoaded',()=>{
      const tbody     = document.getElementById('tbodyLiquidaciones');
      const principal = document.getElementById('principal');
      const overlay   = document.getElementById('overlay');
      const form      = document.getElementById('liquidacionForm');
      const btnAbrir   = document.getElementById('abrirModal');
      const btnCerrar  = document.getElementById('cerrarModal');
      const btnCargar   = document.getElementById('cargarDatos');
      const btnVaciar = document.getElementById('vaciarDatos');
      let opener = null;

      btnCargar.addEventListener('click', ()=>{
        if(!tbody.children.length) cargarFilas(JSON.parse(dataJSON));
      });
      btnVaciar.addEventListener('click', ()=> tbody.innerHTML='');

      function abrir(){
        opener = document.activeElement;
        overlay.classList.add('activo');
        overlay.setAttribute('aria-hidden','false');
        principal.classList.add('deshabilitado');
        poblarSelectModal();
        (document.getElementById('legajoEmpleado') || overlay).focus();
      }
      function cerrar(){
        overlay.classList.remove('activo');
        overlay.setAttribute('aria-hidden','true');
        principal.classList.remove('deshabilitado');
        form.reset();
        opener && opener.focus();
      }

      btnAbrir.addEventListener('click', abrir);
      btnCerrar.addEventListener('click', cerrar);

      form.addEventListener('submit', (e)=>{
        if(!form.checkValidity()){
          e.preventDefault();
          form.reportValidity();
        }
      });
    });
  })();
  </script>
</body>
</html>
